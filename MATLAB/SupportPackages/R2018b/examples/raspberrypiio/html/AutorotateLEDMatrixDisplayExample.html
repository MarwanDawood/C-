
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Auto-rotate LED Matrix Display</title><meta name="generator" content="MATLAB 9.5"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2018-08-10"><meta name="DC.source" content="AutorotateLEDMatrixDisplayExample.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><style>
.open_example { 
    padding:0px 0px 1px 0px;
    margin:20px;
    font-size:0.9em;
    border:1px solid #aeaeae;
    display:block;
    float:right;
    border-radius:5px; -moz-border-radius:5px; -webkit-border-radius:5px;
    background: #ffffff; /* Old browsers */
    background: -moz-linear-gradient(top, #FFFFFF 0%, #E6E6E6 100%); /* FF3.6+ */	
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#FFFFFF), color-stop(100%,#E6E6E6)); /* Chrome,Safari4+ */
    background: -webkit-linear-gradient(top, #FFFFFF 0%,#E6E6E6 100%); /* Chrome10+,Safari5.1+ */
    background: -o-linear-gradient(top,  #ffffff 0%,#e6e6e6 100%); /* Opera 11.10+ */
    background: -ms-linear-gradient(top,  #ffffff 0%,#e6e6e6 100%); /* IE10+ */
    background: linear-gradient(top,  #ffffff 0%,#e6e6e6 100%); /* W3C */
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#FFFFFF', endColorstr='#E6E6E6',GradientType=0 ); /* IE6-9 */
}

.open_example:hover {
    background: #f3f3f3; /* Old browsers */
    background: -moz-linear-gradient(top, #f3f3f3 0%, #d7d7d7 100%); /* FF3.6+ */    
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f3f3f3), color-stop(100%,#d7d7d7)); /* Chrome,Safari4+ */
    background: -webkit-linear-gradient(top, #f3f3f3 0%,#d7d7d7 100%); /* Chrome10+,Safari5.1+ */
    background: -o-linear-gradient(top,  #f3f3f3 0%,#d7d7d7 100%); /* Opera 11.10+ */
    background: -ms-linear-gradient(top,  #f3f3f3 0%,#d7d7d7 100%); /* IE10+ */
    background: linear-gradient(top,  #f3f3f3 0%,#d7d7d7 100%); /* W3C */
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f3f3f3', endColorstr='#d7d7d7',GradientType=0 ); /* IE6-9 */
} 

.open_example a { 
    padding:6px 10px; 
    line-height:130%;
    text-decoration:none;
    float:left;
}
      </style><div class="open_example"><a href="matlab:openExample('raspberrypiio/AutorotateLEDMatrixDisplayExample')">Open this Example</a></div><div class="content"><h1>Auto-rotate LED Matrix Display</h1><!--introduction--><p>This example shows you how to use MATLAB&reg; to read the accelerometer on the Raspberry Pi Sense HAT and control the rotation of the image displayed on the LED matrix.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Introduction</a></li><li><a href="#3">Prerequisites</a></li><li><a href="#4">Required Hardware</a></li><li><a href="#5">Create a Sense HAT object</a></li><li><a href="#6">Setting the Orientation of an Image</a></li><li><a href="#7">Read Accelerometer</a></li><li><a href="#8">Auto-rotating an Image</a></li><li><a href="#11">Run Auto-rotation algorithm in a loop</a></li><li><a href="#12">Summary</a></li></ul></div><h2 id="1">Introduction</h2><p>The Raspberry Pi Sense HAT is an add-on board for Raspberry Pi hardware. It has an 8X8 RGB LED Matrix, a five-position joystick and includes the following sensors:</p><div><ul><li>Humidity sensor</li><li>Pressure sensor</li><li>IMU sensor (Accelerometer, Gyroscope, and Magnetometer).</li></ul></div><p>In this example, you will develop an algorithm to auto-rotate an image displayed on the LED matrix according to the orientation of the Sense HAT.</p><h2 id="3">Prerequisites</h2><div><ul><li>We recommend completing <a href="docid:raspberrypiio_ref.example-working-with-raspberry-pi-sense-hat">Working with Raspberry Pi Sense HAT</a> example.</li></ul></div><h2 id="4">Required Hardware</h2><p>To run this example you will need the following hardware:</p><div><ul><li>Raspberry Pi hardware</li><li>Raspberry Pi Sense HAT</li></ul></div><h2 id="5">Create a Sense HAT object</h2><p>Create a Sense HAT object by executing the following command on the MATLAB prompt.</p><pre class="language-matlab">clear <span class="string">rpi</span>
clear <span class="string">mysensehat</span>
rpi = raspi();
mysensehat = sensehat(rpi);
</pre><p><tt>mysensehat</tt> is a handle to a sensehat object.</p><p>Let us display an image on the LED matrix of Sense HAT.</p><pre class="language-matlab">img = imread(<span class="string">'senseHAT_demo.png'</span>);
displayImage(mysensehat,img);
</pre><h2 id="6">Setting the Orientation of an Image</h2><p>Rotate the image by specifying the value of the 'Orientation'. Default value of Orientation is 0. To change Orientation to 90, execute the following on the MATLAB command prompt:</p><pre class="language-matlab">displayImage(mysensehat,img,90);
</pre><p>Repeat the exercise by changing the orientation to 180 and 270 degrees.</p><h2 id="7">Read Accelerometer</h2><p>When Raspberry Pi is held vertically, the force of gravity acts only on one axis of the accelerometer. Depending on the axis along which the force of gravity is acting, we can determine the orientation of the image. Now, let us read the value of the accelerometer when the board is held is held pointing upwards (HDMI port of the Raspberry Pi board pointing downwards).</p><pre class="language-matlab">accel = readAcceleration(mysensehat)
</pre><p>Repeat the exercise by holding the board in various orientations. Observe the values of acceleration along the principal axis. Depending on how the board is held, we have the following observations.</p><div><ul><li>If the board is rotated to point upwards, then the force of gravity acts along negative Y axis.</li></ul></div><p><img vspace="5" hspace="5" src="../sensehat_rot0.png" alt=""> </p><div><ul><li>If the board is rotated to point downwards, then the force of gravity acts along positive Y axis.</li></ul></div><p><img vspace="5" hspace="5" src="../sensehat_rot180.png" alt=""> </p><div><ul><li>If the board is rotated left, then the force of gravity acts along positive X axis.</li></ul></div><p><img vspace="5" hspace="5" src="../sensehat_rot90.png" alt=""> </p><div><ul><li>If the board is rotated right, then the force of gravity acts along negative X axis.</li></ul></div><p><img vspace="5" hspace="5" src="../sensehat_rot270.png" alt=""> </p><p>Based on these observations, we can heuristically detect the orientation of the Sense HAT board by comparing the acceleration value along X and Y axis to a threshold of 0.75g. If the acceleration along one of these axis exceed 0.75g, we will deem that the board is roughly oriented along that axis.</p><h2 id="8">Auto-rotating an Image</h2><p>We will use the following algorithm to rotate the displayed image according to the board orientation:</p><div><ul><li>If the board is rotated to point upwards, then force of gravity acts along negative y axis. In this case Orientation = 0.</li></ul></div><div><ul><li>If the board is rotated to point downwards, then force of gravity acts along positive y axis. In this case Orientation = 180.</li></ul></div><div><ul><li>If the board is rotated to left, then force of gravity acts along positive X axis. In this case Orientation = 90.</li></ul></div><div><ul><li>If the board is rotated to right, then force of gravity acts along negative X axis. In this case Orientation = 270.</li></ul></div><pre class="language-matlab">orientation = 0;
<span class="keyword">if</span> accel(1) &gt; 0.75
    orientation = 90;
<span class="keyword">elseif</span> accel(1) &lt; -0.75
    orientation = 270;
<span class="keyword">elseif</span> accel(2) &gt; 0.75
    orientation = 180;
<span class="keyword">elseif</span> accel(2) &lt; -0.75
    orientation = 0;
<span class="keyword">end</span>
displayImage(mysensehat,img,orientation);
</pre><h2 id="11">Run Auto-rotation algorithm in a loop</h2><p>We can create a MATLAB function, autorotate.m, from the MATLAB code we developed in the previous sections of this example. To view the MATLAB function in the editor:</p><pre class="language-matlab">edit(<span class="string">'autorotate.m'</span>);
</pre><p>The function autorotate() takes a handle to the Sense HAT object and an image. The function will rotate the displayed image based on the algorithm described above. We will call this function in a loop. To increase the duration for which the function runs, increase upper limit of the 'for' loop in the MATLAB code snippet below. While the MATLAB code is running, rotate the board to see the auto-rotation algorithm in action.</p><pre class="language-matlab"><span class="keyword">for</span> i = 1:1000
    autorotate(mysensehat,img);
<span class="keyword">end</span>
</pre><h2 id="12">Summary</h2><p>This example introduced an application example where the LED matrix display is rotated automatically to track the orientation of the Raspberry Pi board.</p><p class="footer">Copyright 2016 The MathWorks, Inc.<br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2018b</a><br><br>
		  MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.
      </p></div><!--
##### SOURCE BEGIN #####
%% Auto-rotate LED Matrix Display
%
% This example shows you how to use MATLAB(R) to read the accelerometer on
% the Raspberry Pi Sense HAT and control the rotation of the image displayed
% on the LED matrix.

% Copyright 2016 The MathWorks, Inc.



%% Introduction
%
% The Raspberry Pi Sense HAT is an add-on board for
% Raspberry Pi hardware. It has an 8X8 RGB LED Matrix, a five-position joystick
% and includes the following sensors:
%%
% * Humidity sensor
% * Pressure sensor
% * IMU sensor (Accelerometer, Gyroscope, and Magnetometer).
% 
% In this example, you will develop an algorithm to auto-rotate an image displayed on the
% LED matrix according to the orientation of the Sense HAT.


%% Prerequisites
%
% * We recommend completing
% <docid:raspberrypiio_ref.example-working-with-raspberry-pi-sense-hat Working with Raspberry Pi Sense HAT> example.



%% Required Hardware
%
% To run this example you will need the following hardware:
%
% * Raspberry Pi hardware
% * Raspberry Pi Sense HAT



%% Create a Sense HAT object
%
% Create a Sense HAT object by executing the following command on the
% MATLAB prompt.
%
%   clear rpi
%   clear mysensehat
%   rpi = raspi();
%   mysensehat = sensehat(rpi);
%
% |mysensehat| is a handle to a sensehat object.
%
% Let us display an image on the LED matrix of Sense HAT.
%
%   img = imread('senseHAT_demo.png');
%   displayImage(mysensehat,img);
%


%% Setting the Orientation of an Image
%
% Rotate the image by specifying the value of the 'Orientation'.
% Default value of Orientation is 0. To change Orientation to 90, execute
% the following on the MATLAB command prompt:
%
%   displayImage(mysensehat,img,90);
%
% Repeat the exercise by changing the orientation to 180 and 270 degrees.



%% Read Accelerometer
% When Raspberry Pi is held vertically, the
% force of gravity acts only on one axis of the accelerometer.
% Depending on the axis along which the force of gravity is acting, we can
% determine the orientation of the image.
% Now, let us read the value of the accelerometer when the board is held is
% held pointing upwards
% (HDMI port of the Raspberry Pi board pointing downwards).
%
%   accel = readAcceleration(mysensehat)
%
%
% Repeat the exercise by holding the board in various orientations.
% Observe the values of acceleration along the principal axis.
% Depending on how the board is held, we have the following observations.
%
% * If the board is rotated to point upwards, then the force of gravity acts
% along negative Y axis.
% 
% <<../sensehat_rot0.png>>
% 
% * If the board is rotated to point downwards, then the force of gravity acts
% along positive Y axis.
% 
% <<../sensehat_rot180.png>>
%
% * If the board is rotated left, then the force of gravity acts
% along positive X axis.
% 
% <<../sensehat_rot90.png>>
% 
% * If the board is rotated right, then the force of gravity acts
% along negative X axis.
% 
% <<../sensehat_rot270.png>>
% 
%
% Based on these observations, we can heuristically detect the 
% orientation of the Sense HAT board by 
% comparing the acceleration value along X and Y axis to a threshold 
% of 0.75g. If the acceleration along one of these axis exceed 0.75g, we
% will deem that the board is roughly oriented along that axis.
%
% 



%% Auto-rotating an Image
% We will use the following algorithm to rotate the displayed image according
% to the board orientation:
% 
%%
% * If the board is rotated to point upwards, then force of gravity acts
% along negative y axis. In this case Orientation = 0.
%
% * If the board is rotated to point downwards, then force of gravity acts
% along positive y axis. In this case Orientation = 180.
%
% * If the board is rotated to left, then force of gravity acts
% along positive X axis. In this case Orientation = 90.
%
% * If the board is rotated to right, then force of gravity acts
% along negative X axis. In this case Orientation = 270.
%%
%   orientation = 0; 
%   if accel(1) > 0.75
%       orientation = 90;
%   elseif accel(1) < -0.75
%       orientation = 270;
%   elseif accel(2) > 0.75
%       orientation = 180;
%   elseif accel(2) < -0.75
%       orientation = 0;
%   end
%   displayImage(mysensehat,img,orientation);



%% Run Auto-rotation algorithm in a loop
% 
% We can create a MATLAB function, autorotate.m, from the MATLAB code we
% developed in the previous sections of this example. To view the MATLAB
% function in the editor:
% 
%   edit('autorotate.m');
% 
% The function autorotate() takes a handle to the Sense HAT object and
% an image. The function will rotate the displayed image
% based on the algorithm described above. We will call this function 
% in a loop. To increase the duration for which the function runs, increase
% upper limit of the 'for' loop in the MATLAB code snippet below.
% While the MATLAB code is running, rotate the board to see the 
% auto-rotation algorithm in action.
% 
%   for i = 1:1000
%       autorotate(mysensehat,img);
%   end
% 


%% Summary
% 
% This example introduced an application example where the LED matrix
% display is rotated automatically to track the orientation of 
% the Raspberry Pi board. 








##### SOURCE END #####
--></body></html>