<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8"></meta>
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0"></meta>
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge"></meta>
<title>Publish and Subscribe to Messages on ThingSpeak Using MQTT Blocks</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "Simulink Support Package for Raspberry Pi Hardware"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../model-preparation.html",
          "name": "Modeling"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "model-preparation"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Publish and Subscribe to Messages on ThingSpeak Using MQTT Blocks",
          "description": "This example shows you how to publish and subscribe to messages from a ThingSpeak broker using MQTT blocks provided by the Simulink&#174; Support Package for Raspberry Pi&#8482; Hardware.",
          "thumbnailURL": "../../../examples/raspberrypi/win64/mqtt_communication.png",
          "genre": "Example",
          "isBasedOn": {
          "@type": "Product",
          "name": "Simulink"

        },
          "identifier": "raspberrypi.PublishAndSubscribeToMessagesUsingMQTTBlocksExample",
          "name": "PublishAndSubscribeToMessagesUsingMQTTBlocksExample"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('raspberrypi/PublishAndSubscribeToMessagesUsingMQTTBlocksExample')"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "SupportingFiles",

        "itemListElement":
        [
        "mqtt_connect.png",
        "mqtt_publish.png",
        "mqtt_communication.png"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css"></link>


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript"></meta>
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="fe"></meta>
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="ex"></meta>

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="This example shows you how to publish and subscribe to messages from a ThingSpeak broker using MQTT blocks provided by the Simulink&#174; Support Package for Raspberry Pi&#8482; Hardware."></meta><meta xmlns="http://www.w3.org/1999/xhtml" content="../../../examples/raspberrypi/win64/mqtt_communication.png" itemprop="thumbnailUrl"></meta>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" src="../includes/product/scripts/jquery/jquery-latest.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6.css?201901150940" rel="stylesheet" type="text/css"></link>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_lg.css?201901150940" rel="stylesheet" media="screen and (min-width: 1200px)"></link>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_md.css?201901150940" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)"></link>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_sm+xs.css?201901150940" rel="stylesheet" media="screen and (max-width: 991px)"></link>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_sm.css?201901150940" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)"></link>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_xs.css?201901150940" rel="stylesheet" media="screen and (max-width: 767px)"></link>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_offcanvas.css?201901150940" rel="stylesheet" type="text/css"></link>

<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/examples.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/helpservices.js"></script>





<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/bootstrap.min.js" type="text/javascript"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css"></link>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css"></link>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print"></link>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" src="../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container includes_subnav affix-top"><div class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-xs-12 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../../documentation-center.html">Documentation</a></h1></div><button type="button" class="navbar-toggle collapsed subnav visible-xs" data-toggle="collapse" data-target=".mobile_subnav_content"><span class="icon-arrow-down icon_24"></span></button></div><div class="crux_nav_container hidden-xs"><div class="crux_nav"><ul id="topnav_main"><li id="crux_nav_documentation" class="crux_nav_active"><a>All</a></li><li id="crux_nav_example"><a href="../examples.html?category=model-preparation">Examples</a></li><li id="crux_nav_function"><a href="../referencelist.html?type=function&amp;category=model-preparation">Functions</a></li><li id="crux_nav_block"><a href="../referencelist.html?type=block&amp;category=model-preparation">Blocks</a></li><li role="presentation" class="dropdown" id="topnav_more" style="display:none;"><a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false"> More <span class="caret"></span></a><ul class="dropdown-menu"></ul></li></ul></div></div></div><div class="col-xs-12" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2018b" data-language="en" action="../../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="sr-only">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> </input><div class="input-group-btn"><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search pull-right icon_32 visible-xs" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="visible-xs" id="search_actuator"><button class="btn icon-search btn_search pull-right icon_16" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div><div class="row visible-xs" id="mobile_subnav"><div class="col-xs-12"><div class="navbar-collapse collapse mobile_subnav_content"><div class="crux_nav_container"><div class="crux_nav"><ul class="nav navbar-nav subnav"><li id="crux_nav_documentation" class="crux_nav_active"><a>All</a></li><li id="crux_nav_example"><a href="../examples.html?category=model-preparation">Examples</a></li><li id="crux_nav_function"><a href="../referencelist.html?type=function&amp;category=model-preparation">Functions</a></li><li id="crux_nav_block"><a href="../referencelist.html?type=block&amp;category=model-preparation">Blocks</a></li></ul></div></div></div></div></div></div></div><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_actuator" data-toggle="offcanvas" data-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="sr-only">Toggle navigation</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-filter" tabindex="0"></span><span class="offcanvas_actuator_close" tabindex="0"></span></div><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-md-12 hidden-xs hidden-sm"></div></div></div></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar" role="navigation">
<nav class="offcanvas_nav" role="navigation">
<ul class="nav_breadcrumb"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../../documentation-center.html" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html">Simulink Support Package for Raspberry Pi Hardware</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../model-preparation.html" itemprop="url"><span itemprop="title">Modeling</span></a></li></ul><ul class="nav_scrollspy nav">
<li class="nav_scrollspy_function"><a href="#responsive_offcanvas">Publish and Subscribe to Messages on ThingSpeak Using MQTT Blocks</a></li>
<li class="nav_scrollspy_title" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li><a href="#d120e16454" class="intrnllnk">Introduction</a></li><li><a href="#d120e16488" class="intrnllnk">Prerequisites</a></li><li><a href="#d120e16503" class="intrnllnk">Required Hardware</a></li><li><a href="#d120e16514" class="intrnllnk">Step 1: Connect Raspberry Pi to the Computer</a></li><li><a href="#d120e16530" class="intrnllnk">Step 2: Open the Simulink Model to Publish the Message</a></li><li><a href="#d120e16579" class="intrnllnk">Step 3: Open the Simulink Model to Subscribe to the Message</a></li><li><a href="#d120e16620" class="intrnllnk">Step 4: Configure the Publish and Subscribe Model</a></li><li><a href="#d120e16735" class="intrnllnk">Step 5: Run the Publish Model in Normal Mode</a></li><li><a href="#d120e16762" class="intrnllnk">Step 6: Run the Subscribe Model in External Mode</a></li><li><a href="#d120e16786" class="intrnllnk">See Also</a></li></ul>
</nav>
<script src="../includes/product/scripts/offcanvas.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-xs-12">

<section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en"><div id="pgtype-example">
<section itemprop="content"><div class="example_icon"></div><h2 class="title r2018b example" itemprop="title content" id="example-raspberrypi_mqtt_publish_subscribe">Publish and Subscribe to Messages on ThingSpeak Using MQTT Blocks</h2><div class="pull-right examples_short_list" style="width:250px; margin-left: 10px; margin-bottom: 10px;"><div data-pane="metadata" style="margin-bottom: 0px;" class="panel metadata_container"><div class="panel-body metadata_content" style="padding-top:0px; padding-bottom:0px;"><div class="row"><div class="col-xs-12"><a class="btn btn_secondary btn-block" href="matlab:openExample('raspberrypi/PublishAndSubscribeToMessagesUsingMQTTBlocksExample')">Open Example</a></div></div></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="raspberrypi-ex59348521"></meta><meta itemprop="exampletitle" content="Publish and Subscribe to Messages on ThingSpeak Using MQTT Blocks"></meta></div><span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample" class="anchor_target"></span>

<p class="shortdesc">This example shows you how to publish and subscribe to messages from a ThingSpeak broker using MQTT blocks provided by the Simulink&#174; Support Package for Raspberry Pi&#8482; Hardware.</p>

<div class="procedure"><h3 class="title" id="d120e16454">Introduction<span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample-2" class="anchor_target"></span></h3><p>Message Queuing Telemetry Transport (MQTT) is a publish-subscribe architecture developed primarily to connect bandwidth and power-constrained devices over networks. MQTT has two components: an MQTT broker and an MQTT client.</p><p>An MQTT broker is a central point of communication and dispatches all messages between the clients. An MQTT client is a device (for example, a computer or mobile phone) that connects to the broker. A client that sends messages to the broker is a <span class="emphasis"><em>publisher</em></span>. A client that receives messages from the broker is a <span class="emphasis"><em>subscriber</em></span>. For more information on MQTT, see <a href="publish-and-subscribe-to-mqtt-messages.html" class="a">Publish MQTT Messages and Subscribe to Message Topics</a>.</p><p>In this example, ThingSpeak is the MQTT broker, and Raspberry Pi&#8482; is the MQTT client (publisher and subscriber).</p><p>This example has two Simulink&#174; models, <code class="literal"><a href="matlab:raspberrypi_MQTT_publish" target="_blank">Publish_MQTT_messages</a></code> and <code class="literal"><a href="matlab:raspberrypi_MQTT_subscribe" target="_blank">Subscribe_MQTT_messages</a></code>. In this example, you will learn how to publish a message from Raspberry Pi&#8482; to the specified topic in the ThingSpeak MQTT broker. Also, you will learn how to subscribe to the specified topic, and then receive the published message from the ThingSpeak MQTT broker to the same Raspberry Pi&#8482; hardware. This is a loopback message transfer.</p><p></p>
<div class="informalfigure"><div id="d120e16484" class="mediaobject"><p><img src="../../../examples/raspberrypi/win64/xxmqtt_communication.png" alt=""></img></p></div></div><p>
 </p><h3 class="title" id="d120e16488">Prerequisites<span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample-3" class="anchor_target"></span></h3><p>Before you start with this example, we recommend you complete:</p><div class="itemizedlist"><ul><li><p><a href="getting-started-with-raspberry-pi-hardware.html" class="a">Getting Started with Simulink Support Package for Raspberry Pi Hardware</a> example</p></li></ul></div><div class="itemizedlist"><ul><li><p><a href="publish-and-subscribe-to-mqtt-messages.html" class="a">Publish MQTT Messages and Subscribe to Message Topics</a></p></li></ul></div><h3 class="title" id="d120e16503">Required Hardware<span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample-4" class="anchor_target"></span></h3><div class="itemizedlist"><ul><li><p>Raspberry Pi&#8482; hardware</p></li><li><p>Micro USB cable</p></li></ul></div><h3 class="title" id="d120e16514">Step 1: Connect Raspberry Pi to the Computer<span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample-5" class="anchor_target"></span></h3><p><strong class="emphasis bold">1.</strong> Connect the micro USB cable into the micro USB port of the Raspberry Pi&#8482; hardware.</p><p><strong class="emphasis bold">2.</strong> Connect the other end of the cable to your computer. Wait for the power LED on Raspberry Pi&#8482; to stay solid.</p><p><strong class="emphasis bold">3.</strong> Connect the Ethernet port of Raspberry Pi&#8482; to a LAN having an Internet access.</p><h3 class="title" id="d120e16530">Step 2: Open the Simulink Model to Publish the Message<span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample-6" class="anchor_target"></span></h3><p><strong class="emphasis bold">1.</strong> Open the <code class="literal"><a href="matlab:raspberrypi_MQTT_publish" target="_blank">Publish_MQTT_messages</a></code> model.</p><p>In this model, the <a href="mqttpublish.html" class="a">MQTT Publish</a> block accepts a message of <code class="literal">uint8</code> data type to be published to the broker.</p><div class="informalfigure"><div id="d120e16550" class="mediaobject"><p><img src="../../../examples/raspberrypi/win64/PublishAndSubscribeToMessagesUsingMQTTBlocksExample_01.png" alt=""></img></p></div></div><p><strong class="emphasis bold">2.</strong> Double-click the <code class="literal">MQTT Publish</code> block. The parameter values are specified as:</p><div class="code_responsive"><pre class="programlisting">     Parameter   | Value                                           | Description
  ---------------------------------------------------------------------------------------------------------------------------------------------
      Topic      | channels/12345/publish/fields/field1/XXXXXXXXXX | The topic to which Raspberry Pi publishes the message.
                 |                                                 | The topic must follow the format:
                 |                                                 | channels/&lt;channelID&gt;/publish/fields/field&lt;fieldNumber&gt;/&lt;writeAPIKey&gt;
                 |                                                 | In this example,
                 |                                                 | * channelID is specified as 12345.
                 |                                                 | * fieldNumber is specified as 1. You can specify any number from 1 to 8.
                 |                                                 | * writeAPIKey is specified as XXXXXXXXXX.
      QoS        | 0                                               | The ThingSpeak MQTT broker supports only QoS 0.
      Retain Msg | off                                             | The ThingSpeak MQTT broker does not support retain message flag.</pre></div><p>For information on how to find <strong class="emphasis bold">Channel ID</strong> and <strong class="emphasis bold">Write API Key</strong> of your channel, see <a href="thingspeakwrite.html#bvpvot_-53" class="a">Parameters</a>.</p><p><strong class="emphasis bold">3.</strong> Click <strong class="emphasis bold">OK</strong>.</p><h3 class="title" id="d120e16579">Step 3: Open the Simulink Model to Subscribe to the Message<span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample-9" class="anchor_target"></span></h3><p><strong class="emphasis bold">1.</strong> Open the <code class="literal"><a href="matlab:raspberrypi_MQTT_subscribe" target="_blank">Subscribe_MQTT_messages</a></code> model.</p><div class="informalfigure"><div id="d120e16592" class="mediaobject"><p><img src="../../../examples/raspberrypi/win64/PublishAndSubscribeToMessagesUsingMQTTBlocksExample_02.png" alt=""></img></p></div></div><p><strong class="emphasis bold">2.</strong> Double-click the <a href="mqttsubscribe.html" class="a">MQTT Subscribe</a> block. The parameter values are specified as:</p><div class="code_responsive"><pre class="programlisting">     Parameter           | Value                                             | Description
  ------------------------------------------------------------------------------------------------------------------------------------------------------------
      Topic              | channels/12345/subscribe/fields/field1/YYYYYYYYYY | The topic to which Raspberry Pi subscribes.
                         |                                                   | The topic must follow the format:
                         |                                                   | channels/&lt;channelID&gt;/subscribe/fields/field&lt;fieldNumber&gt;/&lt;readAPIKey&gt;
                         |                                                   | In this example,
                         |                                                   | * channelID is specified as 12345.
                         |                                                   | * fieldNumber is specified as 1. You can specify any number from 1 to 8.
                         |                                                   | * readAPIKey is specified as YYYYYYYYYY.
      QoS                | 0                                                 | The ThingSpeak MQTT broker supports only QoS 0.
      Message length (N) | 1                                                 | The length of the message to be received.
      Sample time        | 1                                                 | Raspberry Pi(TM) receives the message from the ThingSpeak MQTT broker every one second.</pre></div><p>For information on how to find <strong class="emphasis bold">Channel ID</strong> and <strong class="emphasis bold">Read API Key</strong> of your channel, see <span class="missinglink"></span>.</p><p><strong class="emphasis bold">3.</strong> Click <strong class="emphasis bold">OK</strong>.</p><h3 class="title" id="d120e16620">Step 4: Configure the Publish and Subscribe Model<span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample-12" class="anchor_target"></span></h3><p><strong class="emphasis bold">1.</strong> Open the <code class="literal"><a href="matlab:raspberrypi_MQTT_publish" target="_blank">Publish_MQTT_messages</a></code> model.</p><p><strong class="emphasis bold">2.</strong> In your Simulink&#174; model, click <strong class="emphasis bold">Simulation</strong> &gt; <strong class="emphasis bold">Model Configuration Parameters</strong>.</p><p><strong class="emphasis bold">3.</strong> In the Configuration Parameters dialog box, select <strong class="emphasis bold">Hardware Implementation</strong>.</p><p><strong class="emphasis bold">4.</strong> Set the <strong class="emphasis bold">Hardware board</strong> parameter to <code class="literal">Raspberry Pi</code>. This selection automatically populates the parameters in the <strong class="emphasis bold">Hardware board</strong> settings with the default values for Raspberry Pi&#8482;.</p><p><strong class="emphasis bold">5.</strong> From the <strong class="emphasis bold">Groups</strong> list under <strong class="emphasis bold">Target hardware resources</strong>, select <strong class="emphasis bold">MQTT</strong> and verify these settings:</p><div class="itemizedlist"><ul><li><p><strong class="emphasis bold">Broker Address</strong>: Specify the address of the ThingSpeak MQTT broker, <code class="literal">mqtt.thingspeak.com</code>.</p></li><li><p><strong class="emphasis bold">Username</strong>: For ThingSpeak broker, <strong class="emphasis bold">Username</strong> is not required.</p></li><li><p><strong class="emphasis bold">Password</strong>: Specify the <strong class="emphasis bold">MQTT API Key</strong> of your ThingSpeak account. If you do not know the <strong class="emphasis bold">MQTT API Key</strong>, sign in to ThingSpeak and go to <strong class="emphasis bold">Account</strong> &gt; <strong class="emphasis bold">My Profile</strong>.</p></li><li><p><strong class="emphasis bold">Client ID</strong>: <strong class="emphasis bold">Client ID</strong> is optional.</p></li></ul></div><p><strong class="emphasis bold">6.</strong> Click <strong class="emphasis bold">Apply</strong> to save your changes, and click <strong class="emphasis bold">OK</strong>.</p><p><strong class="emphasis bold">7.</strong> Open the <code class="literal"><a href="matlab:raspberrypi_MQTT_subscribe" target="_blank">Subscribe_MQTT_messages</a></code> model and repeat all the steps as described in this section.</p><h3 class="title" id="d120e16735">Step 5: Run the Publish Model in Normal Mode<span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample-13" class="anchor_target"></span></h3><p><strong class="emphasis bold">1.</strong> In your Simulink&#174; model, click the Deploy to Hardware button. The lower left corner of the model window displays the status while Simulink&#174; prepares, downloads, and runs the model on Raspberry Pi&#8482;. The model is deployed as a standalone application on Raspberry Pi&#8482;. After the model is successfully deployed, Raspberry Pi&#8482; publishes the message to the <strong class="emphasis bold">Field 1</strong> of the ThingSpeak MQTT broker.</p><p><strong class="emphasis bold">2.</strong> To view the published message on the broker, select to <strong class="emphasis bold">Channels</strong> &gt; <strong class="emphasis bold">My Channels</strong>, and then click the channel on which the message is published.</p><p></p>
<div class="informalfigure"><div id="d120e16758" class="mediaobject"><p><img src="../../../examples/raspberrypi/win64/xxmqtt_publish.png" alt=""></img></p></div></div><p>
 </p><h3 class="title" id="d120e16762">Step 6: Run the Subscribe Model in External Mode<span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample-14" class="anchor_target"></span></h3><p><strong class="emphasis bold">1.</strong> In your Simulink&#174; model, set Simulation mode to <code class="literal">External</code>. The Simulation stop time is specified as <code class="literal">inf</code>.</p><p><strong class="emphasis bold">2.</strong> Click the Run button. The lower left corner of the model window displays status while Simulink&#174; prepares, downloads, and runs the model on Raspberry Pi&#8482;. After the model successfully starts running, Raspberry Pi&#8482; subscribes to the messages in the <strong class="emphasis bold">Field 1</strong> of the ThingSpeak MQTT broker and receives the message. The <code class="literal">Display_Message</code> block displays the received message.</p><h3 class="title" id="d120e16786">See Also<span id="PublishAndSubscribeToMessagesUsingMQTTBlocksExample-15" class="anchor_target"></span></h3><p><a href="publish-and-subscribe-to-mqtt-messages.html" class="a">Publish MQTT Messages and Subscribe to Message Topics</a></p></div></section>
    </div><div class="clearfix"></div>
<div class="feedbackblock">Was this topic helpful?
<input type="button" value="Yes" onClick="openFeedbackWindow('https://www.mathworks.com/programs/bounce_hub_help.html?s_cid=Help_Topic_Survey&amp;surveyParams='+document.location.href+'-YES-R2018b');"></input>
<input type="button" value="No" onClick="openFeedbackWindow('https://www.mathworks.com/programs/bounce_hub_help.html?s_cid=Help_Topic_Survey&amp;surveyParams='+document.location.href+'-NO-R2018b');"></input>
</div>
</section>

<!--Last updated: Tue Jan 15 09:40:40 EST 2019-->
</div>
</div>
</div><!--close_0960-->
</div><!--close_0970-->
<div xmlns="http://www.w3.org/1999/xhtml" class="body_trail_container">
<div class="container-fluid">
<div class="row">
<div class="col-xs-12">
<div class="row"><div class="col-xs-12 col-sm-3"><h5><a href="../index.html?s_cid=doc_ftr">Simulink Support Package for Raspberry Pi Hardware Documentation</a></h5>
<ul class="list-unstyled hidden-xs"><li><a href="../examples.html?s_cid=doc_ftr">Examples</a></li>
<li><a href="../referencelist.html?type=function&amp;s_cid=doc_ftr">Functions and Other Reference</a></li>
<li><a href="../release-notes.html?s_cid=doc_ftr">Release Notes</a></li>
</ul>
</div>
<div class="col-xs-12 col-sm-3"><h5><a href="https://www.mathworks.com/support.html?s_cid=doc_ftr">Support</a></h5>
<ul class="list-unstyled hidden-xs"><li><a href="https://www.mathworks.com/matlabcentral/answers/index?s_cid=doc_ftr">MATLAB Answers</a></li><li><a href="https://www.mathworks.com/support/install-matlab.html?s_cid=doc_ftr">Installation Help</a></li><li><a href="https://www.mathworks.com/support/bugreports/?s_cid=doc_ftr">Bug Reports</a></li><li><a href="https://www.mathworks.com/products/availability.html?s_cid=doc_ftr">Product Requirements</a></li><li><a href="https://www.mathworks.com/downloads/?s_cid=doc_ftr">Software Downloads</a></li></ul>
</div>
</div>
</div>
</div>
</div><!--END.CLASS container-fluid-->
</div><!--END.CLASS body_trail_container-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-xs-12">
<p class="copyright">© 1994-2019 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="MATLAB:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="MATLAB:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="MATLAB:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="MATLAB:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</body>
</html>
